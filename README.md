# Домашнее задание к занятию «Компоненты Kubernetes»

### Цель задания

Рассчитать требования к кластеру под проект

------

### Задание. Необходимо определить требуемые ресурсы
Известно, что проекту нужны база данных, система кеширования, а само приложение состоит из бекенда и фронтенда. Опишите, какие ресурсы нужны, если известно:

1. Необходимо упаковать приложение в чарт для деплоя в разные окружения. 
2. База данных должна быть отказоустойчивой. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии. 
3. Кеш должен быть отказоустойчивый. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии. 
4. Фронтенд обрабатывает внешние запросы быстро, отдавая статику. Потребляет не более 50 МБ ОЗУ на каждый экземпляр, 0.2 ядра. 5 копий. 
5. Бекенд потребляет 600 МБ ОЗУ и по 1 ядру на копию. 10 копий.

----
### Решение:


## Требования к кластеру

| Компонент   | Ресурсы (ОЗУ) | Ресурсы (ядра) | Количество копий |
|-------------|--------------|----------------|------------------|
| База данных | 4 ГБ         | 1              | 3                |
| Кеш         | 4 ГБ         | 1              | 3                |
| Фронтенд    | 50 МБ        | 0.2            | 5                |
| Бекенд      | 600 МБ       | 1              | 10               |

## Расчет ресурсов кластера
Исходя из предоставленной выше статьи сначала нам необходимо расчитать общеее количество необзодимых ресурсов:   
CPU 1 * 3 + 1 * 3 + 0.2 * 5 + 1 * 10 = 17 ядер   
RAM 4 * 3 + 4 * 3 + 0.05 * 5 + 0.6 * 10 = 30.25   
Для системных компонентов Managed Kubernetes резервирует виртуальные CPU для каждого узла по следующим правилам:   
6% от первого ядра;   
1% от второго ядра;   
0.5% от третьего и четвертого ядра;   
0.25% от любого последующего количества ядер свыше четырех.   
Для системных компонентов Managed Kubernetes резервирует оперативную память для каждого узла по следующим правилам:   
255 МиБ для виртуальной машины с оперативной памятью менее 1 ГиБ;   
25% от первых 4 ГиБ оперативной памяти;   
20% от следующих 4 ГиБ (до 8 ГиБ);   
10% от следующих 8 ГиБ (до 16 ГиБ);   
6% от следующих 112 ГиБ (до 128 ГиБ);   
2% оперативной памяти свыше 128 ГиБ.   
Managed Kubernetes также резервирует дополнительные 100 МиБ оперативной памяти на каждом узле, чтобы обработать вытеснение подов (eviction).   

Допустим если взять ноды 8CPU 16MEM    
Доступные vCPU для рабочих нагрузок:   
8 – 0.09 = 7.91   
Доступная RAM для рабочих нагрузок:   
16 – 2.7 = 13.3 ГиБ
7.91 * 3 = 23.73 > 17 необходимой нагрузки   
13.3 * 3 =  39.9 > 30.25 необходимой нагрузки   
Получается 3 worker ноды достаточно чтобы покрыть с запасом необходимые ресурсы, плюс одна нода на случай выхода из строя одной из нод.

Минимальный объем ресурсов для одного управляющего узла (Master Node)   
CPU 2 RAM 4    
В лекции говорилось, что для отказоустойчивости необходимо минимум три master ноды.   

## Мой ответ :
4 ноды CPU 8 RAM 16 и 3 ноды CPU 2 RAM 4   
Данные ресурсы обеспечат отказоустойчивость и возможность масштабирования.




